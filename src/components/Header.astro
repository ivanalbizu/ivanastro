---
// TODO: marcar ítem de menú activo
import Button from "@components/Button.astro";
import { config } from "../config";

const { base = "" } = Astro.site
  ? { base: import.meta.env.BASE_URL }
  : { base: "" };
---

<header class="site-header">
  <div class="skip-to-content">
    <a href="#main-content">Saltar al contenido principal</a>
    <a href="#footer">Saltar a enlaces en pié de página</a>
  </div>
  <div class="header-content">
    <Button
      tag="button"
      variant="link"
      size="sm"
      class="mobile-only"
      id="hamburger-toggle"
      aria-label="Abrir menú de navegación"
      aria-expanded="false"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 48 48"
        aria-hidden="true"
      >
        <path
          fill="none"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="4"
          d="M7.95 11.95h32m-32 12h32m-32 12h32"></path>
      </svg>
      <span class="visually-hidden">Abrir menú de navegación</span>
    </Button>

    <div class="site-title">
      <a href={base}>
        {config.title}
      </a>
    </div>

    <div class="header-controls">
      <nav
        class="main-navigation"
        id="main-navigation"
        role="navigation"
        aria-label="Principal"
      >
        <ul class="nav-list">
          <li>
            <Button
              tag="button"
              variant="link"
              size="sm"
              class="close-menu"
              id="close-menu"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 48 48"
                aria-hidden="true"
              >
                <path
                  fill="currentColor"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="4"
                  d="m8 8l32 32M8 40L40 8"></path>
              </svg>
              <span class="visually-hidden">Cerrar menú de navegación</span>
            </Button>
          </li>
          <li><a href={base + "blog"} class="nav-link">Blog</a></li>
          <li><a href={base + "categorias"} class="nav-link">Categorias</a></li>
          <li><a href={base + "sobre-mi"} class="nav-link">Sobre mí</a></li>
          <li>
            <a
              href={base + "cv-ivan-gonzalez-albizu.pdf"}
              class="nav-link"
              target="_blank">CV</a
            >
          </li>
        </ul>
      </nav>

      <div class="mobile-controls">
        <Button tag="button" variant="link" size="sm" id="theme-toggle">
          <svg
            class="sun-icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"
            ></circle>
            <path
              d="M12 1v6m0 6v6m11-7h-6m-6 0H1"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"></path>
          </svg>
          <svg
            class="moon-icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <path
              d="M21 12.79A9 9 0 1 1 11.21 3 A7 7 0 0 0 21 12.79z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linejoin="round"></path>
          </svg>
          <span class="visually-hidden"
            >Activar / Desactivar el modo oscuro</span
          >
        </Button>
        <Button tag="button" variant="link" size="sm" id="search-toggle">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <circle
              cx="11"
              cy="11"
              r="8"
              stroke="currentColor"
              stroke-width="2"
              fill="none"></circle>
            <path
              d="M21 21l-4.35-4.35"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"></path>
          </svg>
          <span class="visually-hidden">Buscar entradas</span>
        </Button>
      </div>
    </div>
  </div>
</header>

<search class="search-overlay" id="search-overlay">
  <div class="search-container">
    <div class="search-header">
      <input
        type="text"
        class="search-input"
        id="search-input"
        placeholder="Buscar artículos..."
        autocomplete="off"
      />
      <Button
        tag="button"
        variant="link"
        size="sm"
        id="search-close"
        aria-label="Abrir menú de navegación"
        aria-expanded="false"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 48 48"
          aria-hidden="true"
        >
          <path
            fill="currentColor"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="4"
            d="m8 8l32 32M8 40L40 8"></path>
        </svg>
        <span class="visually-hidden">Cerrar búsqueda</span>
      </Button>
    </div>
  </div>
  <div
    class="search-results"
    id="search-results"
    role="region"
    aria-live="polite"
  >
  </div>
</search>

<script src="../assets/js/script.ts"></script>

<style lang="scss">
  .skip-to-content {
    a {
      padding: 6px;
      position: absolute;
      top: -40px;
      left: 0px;
      color: white;
      border-right: 1px solid white;
      border-bottom: 1px solid white;
      border-bottom-right-radius: 8px;
      background: #bf1722;
      transition: top 0.5s ease-out;
      z-index: 100;
    }
    a:focus {
      position: absolute;
      left: 0px;
      top: 0px;
      outline-color: transparent;
      transition: top 0.05s ease-in;
    }
  }
  .site-header {
    border-bottom: var(--border-width-md) solid var(--color-border);
    background-color: var(--color-surface);
    padding: calc(var(--grid-unit) * 2) 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-content {
    max-width: var(--max-width);
    margin-inline: auto;
    display: grid;
    grid-template-columns: auto auto 1fr;
    justify-content: space-between;
    align-items: center;
    gap: calc(var(--grid-unit) * 2);
    padding: 0 calc(var(--grid-unit) * 2);
  }

  .site-title a {
    display: flex;
    min-height: var(--target-size);
    align-items: center;
    font-family: var(--font-family-primary);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    color: var(--color-text-primary);
    padding: calc(var(--grid-unit) / 2) 0;
    transition:
      color var(--transition-duration-normal) ease,
      text-decoration var(--transition-duration-normal) ease;
    text-underline-offset: 6px;
    text-decoration-color: transparent;
    text-decoration-thickness: 2px;

    &.active,
    &:hover,
    &:focus {
      color: var(--color-interaction-default);
      text-decoration-color: revert;
    }
  }

  .header-controls {
    display: flex;
    align-items: center;
    gap: calc(var(--grid-unit) * 3);
    justify-self: end;
  }

  .search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    padding-inline: calc(var(--grid-unit) * 2);
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity var(--transition-duration-slow) ease,
      visibility var(--transition-duration-slow) ease;
  }

  .search-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .search-container {
    max-width: 800px;
    margin: calc(var(--grid-unit) * 5) auto calc(var(--grid-unit) * 3) auto;
  }

  .search-header {
    display: flex;
    align-items: center;
    gap: calc(var(--grid-unit) * 2);
    background: var(--color-background);
    border: var(--border-width-md) solid var(--color-border);
    border-radius: 8px;
    padding: calc(var(--grid-unit) * 3);
    margin-bottom: calc(var(--grid-unit) * 5);
  }

  .search-input {
    flex: 1;
    font-family: var(--font-body);
    font-size: var(--fs-heading-6);
    color: var(--color-text-primary);
    padding: calc(var(--grid-unit) * 2) calc(var(--grid-unit) * 3);
  }

  .search-input::placeholder {
    color: var(--color-medium-gray);
  }

  .search-results {
    max-width: 800px;
    margin-inline: auto;
    max-height: 70vh;
    min-height: 40vh;
    overflow-y: auto;
    background: var(--color-background);
    border-radius: 8px;
    border: 1px solid var(--color-border);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: calc(var(--grid-unit) * 2) calc(var(--grid-unit) * 2.5)
      calc(var(--grid-unit) * 3) calc(var(--grid-unit) * 2.5);
    &:empty {
      display: none;
    }
    &-header {
      padding: calc(var(--grid-unit) * 2) calc(var(--grid-unit) * 2.5);
      margin: calc(var(--grid-unit) * -2) calc(var(--grid-unit) * -2.5)
        calc(var(--grid-unit) * 2) calc(var(--grid-unit) * -2.5);
      border-bottom: 1px solid var(--color-border);
      background: var(--color-surface);
      position: sticky;
      top: 0;
      z-index: 1;
      p {
        margin: 0;
        font-family: var(--font-mono);
        font-size: var(--fs-paragraph-4);
        color: var(--color-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }
    }
  }

  .search-result {
    padding: calc(var(--grid-unit) * 4) calc(var(--grid-unit) * 3);
    margin-bottom: calc(var(--grid-unit) * 1.5);
    border-bottom: 1px solid var(--color-border);
    transition: background-color var(--transition-duration-normal) ease;
    &:hover {
      background-color: var(--color-surface);
    }
    &:last-child {
      border-bottom: none;
    }
  }
  :global(.search-result + .search-result) {
    margin-top: calc(var(--grid-unit) * 3);
  }

  .search-result-title {
    font-family: var(--font-family-primary);
    font-size: var(--fs-heading-4);
    font-weight: 700;
    margin-bottom: calc(var(--grid-unit) * 2);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    a {
      color: var(--color-text-primary);
      text-decoration-color: transparent;
    }
    &:hover,
    &:focus {
      color: var(--color-interaction-default);
    }
  }

  .search-result-date {
    font-family: var(--font-mono);
    font-size: var(--fs-paragraph-5);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    display: block;
    margin-bottom: calc(var(--grid-unit) * 3);
  }

  .search-result-excerpt {
    color: var(--color-text-secondary);
    line-height: 1.8;
    margin-bottom: calc(var(--grid-unit) * 4);
  }

  .search-result-categories {
    display: flex;
    flex-wrap: wrap;
    gap: calc(var(--grid-unit) * 2);
    margin-top: calc(var(--grid-unit) * 3);
  }

  .search-category {
    background-color: #e8a100;
    color: var(--color-text-primary);
    padding: calc(var(--grid-unit)) calc(var(--grid-unit) * 2);
    font-size: var(--fs-paragraph-5);
    font-family: var(--font-mono);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    border-radius: 3px;
    transition: all var(--transition-duration-normal) ease;
    &:hover {
      background-color: #c13127;
      color: white;
    }
  }

  /* Dark mode search category styles */
  :global([data-theme="dark"]) .search-category {
    background-color: var(--color-surface);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
  }

  :global([data-theme="dark"]) .search-category:hover {
    background-color: var(--color-interaction-default);
    color: white;
    border-color: var(--color-interaction-default);
  }

  :global([data-theme="dark"]) .search-input {
    color: var(--color-black);
  }

  .search-no-results {
    padding: calc(var(--grid-unit) * 10) calc(var(--grid-unit) * 6);
    text-align: center;
  }

  .search-no-results p {
    color: var(--color-text-muted);
    font-style: italic;
    margin: 0;
    font-size: var(--fs-paragraph-1);
  }

  .nav-list {
    display: block;
    list-style-type: "";
    margin: 0;
    padding: 0;
    gap: calc(var(--grid-unit) * 2);
    li {
      margin-block-end: 0;
    }
  }

  .close-menu {
    margin: calc(var(--grid-unit) * 2);
  }
  @media (min-width: 768px) {
    .nav-list {
      display: flex;
    }
    .close-menu {
      display: none !important;
    }
  }

  .mobile-controls {
    display: flex;
    align-items: center;
    gap: calc(var(--grid-unit));
  }

  @media (max-width: 767.98px) {
    .main-navigation {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      padding: var(--grid-unit);
      background-color: var(--color-background);
      z-index: 99;
      transform: translateX(-100%);
      transition:
        transform var(--transition-duration-slow) ease,
        visibility 0s var(--transition-duration-slow) ease;
      overflow-y: auto;
      visibility: hidden;
    }
  }
  .main-navigation.active {
    transform: translateX(0);
    visibility: visible;
    transition: transform var(--transition-duration-slow) ease;
  }
  :global(.is-resizing) {
    .main-navigation {
      transition: none;
    }
  }

  .mobile-nav-list {
    list-style-type: "";
    margin: 0;
    padding: calc(var(--grid-unit) * 4) 0;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: calc(var(--grid-unit) * 3) calc(var(--grid-unit) * 4);
    font-family: var(--font-family-primary);
    font-weight: 700;
    font-size: var(--fs-heading-4);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-text-primary);
    text-decoration-color: transparent;
    border-bottom: 1px solid var(--color-border);
    min-height: var(--target-size);
    transition:
      color var(--transition-duration-normal) ease,
      text-decoration var(--transition-duration-normal) ease;
    &.active,
    &:hover,
    &:focus {
      color: var(--color-interaction-default);
      background-color: var(--color-surface);
    }
  }

  @media (min-width: 768px) {
    .nav-link {
      font-size: var(--fs-paragraph-2);
      letter-spacing: 0.03em;
      padding: calc(var(--grid-unit) / 2) calc(var(--grid-unit));
      text-underline-offset: 6px;
      text-decoration-color: transparent;
      text-decoration-thickness: 2px;
      border-bottom: 0;
      &.active,
      &:hover,
      &:focus {
        color: var(--color-interaction-default);
        text-decoration-color: revert;
        background-color: transparent;
      }
    }

    .site-header {
      padding: calc(var(--grid-unit) * 3) 0;
    }
    .header-content {
      display: flex;
      flex-wrap: wrap;
      gap: calc(var(--grid-unit) * 2);
      padding: 0 var(--content-padding);
    }
    .mobile-only {
      display: none;
    }
    .mobile-controls {
      gap: calc(var(--grid-unit) * 2);
    }
    .search-container {
      margin: calc(var(--grid-unit) * 10) auto calc(var(--grid-unit) * 4) auto;
    }
    .search-results {
      padding: calc(var(--grid-unit) * 3) calc(var(--grid-unit) * 4)
        calc(var(--grid-unit) * 4) calc(var(--grid-unit) * 4);
      &-header {
        padding: calc(var(--grid-unit) * 3) calc(var(--grid-unit) * 4);
        margin: calc(var(--grid-unit) * -3) calc(var(--grid-unit) * -4)
          calc(var(--grid-unit) * 3) calc(var(--grid-unit) * -4);
      }
    }
    .search-result {
      padding: calc(var(--grid-unit) * 6) calc(var(--grid-unit) * 6);
      margin-bottom: calc(var(--grid-unit) * 2);
    }
    .search-result-title {
      margin-bottom: calc(var(--grid-unit) * 3);
    }
    .search-result-categories {
      gap: calc(var(--grid-unit) * 2.5);
    }
    .search-category {
      padding: calc(var(--grid-unit) * 1.5) calc(var(--grid-unit) * 2.5);
    }
    .search-result-date {
      margin-bottom: calc(var(--grid-unit) * 4);
    }
    .search-result-excerpt {
      margin-bottom: calc(var(--grid-unit) * 5);
    }
  }
</style>
