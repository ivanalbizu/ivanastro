---
import type { Polymorphic } from "astro/types";

type Tag = "a" | "button" | "span";

type Props<TagGeneric extends Tag> = {
  tag: TagGeneric;
  variant?: "link" | "secondary" | "tertiary";
  size?: "sm" | "lg";
  hasChevron?: boolean;
  disabled?: boolean;
  classList?: string[];
} & Polymorphic<{ as: TagGeneric }>;

const {
  tag: Tag,
  variant = null,
  size = null,
  hasChevron = false,
  disabled = false,
  classList = [],
  href,
  type = "button",
  ...rest
} = Astro.props;

const baseAttributes = {
  classes: [
    "btn",
    variant ? `btn--${variant}` : "",
    size ? `btn--${size}` : "",
    disabled ? `btn--disabled` : "",
    ...classList,
  ],
  ...rest,
};

const anchorAttributes = {
  href: href,
};

const buttonAttributes = {
  type: type,
};

const attributeBasedOnTag = Tag === "a" ? anchorAttributes : buttonAttributes;

const allAttributes = { ...baseAttributes, ...attributeBasedOnTag };

const { classes, ...attributes } = allAttributes;
---

<Tag class:list={[classes]} {...attributes}>
  <slot name="icon" />
  <slot />
  {
    hasChevron && (
      <span class="btn__chevron">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="m9 18l6-6l-6-6"
          />
        </svg>
      </span>
    )
  }
</Tag>

<style lang="scss">
  .btn {
    font-family: var(--typography-font-family-primary);
    font-size: var(--typography-font-size-btn-default);
    letter-spacing: var(--typography-letter-spacing-md);
    line-height: var(--typography-line-height-lg);
    padding: var(--space-xxs) var(--space-md);
    border-radius: var(--border-radius-md);
    border-width: var(--border-width-md);
    border-style: solid;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: var(--space-xxs);
    text-align: left;
    cursor: pointer;
    transition:
      color var(--transition-duration-slow) ease,
      background-color var(--transition-duration-slow) ease,
      border-color var(--transition-duration-slow) ease,
      box-shadow var(--transition-duration-slow) ease;

    // =========================================================================
    // FOCUS VISIBLE - Accesibilidad teclado (WCAG 2.4.7)
    // =========================================================================
    &:focus-visible {
      outline: 3px solid var(--btn-focus-ring);
      outline-offset: 2px;
    }

    // =========================================================================
    // PRIMARY (default)
    // =========================================================================
    background-color: var(--btn-primary-bg);
    color: var(--btn-primary-fg);
    border-color: var(--btn-primary-border);

    &:hover {
      background-color: var(--btn-primary-hover-bg);
      color: var(--btn-primary-hover-fg);
      border-color: var(--btn-primary-hover-border);
    }

    &:active,
    &.active {
      background-color: var(--btn-primary-active-bg);
      color: var(--btn-primary-active-fg);
      border-color: var(--btn-primary-active-border);
    }

    // =========================================================================
    // LINK
    // =========================================================================
    &--link {
      background-color: var(--btn-link-bg);
      color: var(--btn-link-fg);
      border-color: var(--btn-link-border);
      text-decoration: underline;
      text-decoration-color: transparent;
      text-underline-offset: 4px;
      transition:
        color var(--transition-duration-slow) ease,
        text-decoration-color var(--transition-duration-slow) ease;

      &:hover {
        background-color: var(--btn-link-hover-bg);
        color: var(--btn-link-hover-fg);
        border-color: var(--btn-link-hover-border);
        text-decoration-color: currentColor;
      }

      &:active,
      &.active {
        background-color: var(--btn-link-active-bg);
        color: var(--btn-link-active-fg);
        border-color: var(--btn-link-active-border);
        text-decoration-color: currentColor;
      }
    }

    // =========================================================================
    // SECONDARY
    // =========================================================================
    &--secondary {
      background-color: var(--btn-secondary-bg);
      color: var(--btn-secondary-fg);
      border-color: var(--btn-secondary-border);

      &:hover {
        background-color: var(--btn-secondary-hover-bg);
        color: var(--btn-secondary-hover-fg);
        border-color: var(--btn-secondary-hover-border);
      }

      &:active,
      &.active {
        background-color: var(--btn-secondary-active-bg);
        color: var(--btn-secondary-active-fg);
        border-color: var(--btn-secondary-active-border);
      }
    }

    // =========================================================================
    // TERTIARY
    // =========================================================================
    &--tertiary {
      background-color: var(--btn-tertiary-bg);
      color: var(--btn-tertiary-fg);
      border-color: var(--btn-tertiary-border);

      &:hover {
        background-color: var(--btn-tertiary-hover-bg);
        color: var(--btn-tertiary-hover-fg);
        border-color: var(--btn-tertiary-hover-border);
      }

      &:active,
      &.active {
        background-color: var(--btn-tertiary-active-bg);
        color: var(--btn-tertiary-active-fg);
        border-color: var(--btn-tertiary-active-border);
      }
    }

    // =========================================================================
    // SIZES
    // =========================================================================
    &--sm {
      padding: var(--space-xxxs) var(--space-xxs);
      font-size: var(--typography-font-size-btn-sm);
      letter-spacing: var(--typography-letter-spacing-md);
      line-height: var(--typography-line-height-xs);
      min-height: 34px;
    }

    // =========================================================================
    // DISABLED
    // =========================================================================
    &--disabled {
      opacity: 0.4;
      pointer-events: none;
      cursor: not-allowed;
    }

    // =========================================================================
    // INNER ELEMENTS
    // =========================================================================
    &__icon {
      align-self: start;
    }

    &__chevron {
      margin-left: auto;
      display: flex;
    }
  }
</style>
